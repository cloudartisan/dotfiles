#!/bin/bash

# Install Claude Code CLI tool using official installer
# This script runs once when chezmoi is applied

echo "üì¶ Installing Claude Code CLI..."

# Check if Claude Code is already installed and working
if command -v claude >/dev/null 2>&1; then
  CURRENT_VERSION=$(claude --version 2>/dev/null | grep -o '[0-9.]*' | head -1)
  if [ -n "$CURRENT_VERSION" ]; then
    echo "‚úÖ Claude Code already installed (version $CURRENT_VERSION)"
    exit 0
  fi
fi

# Install Claude Code using official installer
echo "Installing Claude Code via official installer..."
if curl -fsSL https://claude.ai/install.sh | sh; then
  echo "‚úÖ Claude Code installed successfully to ~/.local/bin/claude"
  
  # Verify installation (add ~/.local/bin to PATH for verification)
  export PATH="$HOME/.local/bin:$PATH"
  if claude --version >/dev/null 2>&1; then
    echo "‚úÖ Claude Code verified working"
  else
    echo "‚ö†Ô∏è  Claude Code installed but may need PATH refresh"
  fi
else
  echo "‚ùå Failed to install Claude Code"
  exit 1
fi